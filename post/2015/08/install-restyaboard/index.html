<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><title>かんばん系プロジェクト管理OSSのRestyaboardをインストールしてみる - Namiking.net</title><link rel="stylesheet" href="/css/bundle.css"><script src="/js/bundle.js"></script></head><body><div class="layout-sitenavi"><div class="container"><div class="layout-sitenavi__title"><a href="http://blog.namiking.net/"><strong>Namiking.net</strong><p>Web系エンジニアの技術ブログ</p></a></div><div class="layout-sitenavi__menu"><ul><li><a href="http://blog.namiking.net/about/"><i class="fa fa-lg fa-user"></i><span>ABOUT</span></a></li><li><a href="https://github.com/namikingsoft/"><i class="fa fa-lg fa-github"></i><span>GITHUB</span></a></li><li><a href="https://twitter.com/namikingsoft/"><i class="fa fa-lg fa-twitter"></i><span>TWITTER</span></a></li></ul></div></div></div><div class="layout-headline-single"><div class="container"><header><div class="layout-headline-single__title"><h1>かんばん系プロジェクト管理OSSのRestyaboardをインストールしてみる</h1></div><div class="lead"><div class="layout-headline-single__meta"><ul><li><i class="fa fa-calendar"></i>2015-08-27 (Thu)</li><li><img src="https://s.gravatar.com/avatar/3706c1a344dc2282c6683b6c6d0926f2?s=27&r=g">namikingsoft</li></ul></div><div class="layout-headline-single__taxonomies"><ul><li><a class="label label-success" href="/categories/%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E7%AE%A1%E7%90%86%E3%83%84%E3%83%BC%E3%83%AB">プロジェクト管理ツール</a></li><li><a class="label label-default" href="/tags/restyaboard">Restyaboard</a></li><li><a class="label label-default" href="/tags/oss">OSS</a></li><li><a class="label label-default" href="/tags/vagrant">Vagrant</a></li><li><a class="label label-default" href="/tags/itamae">Itamae</a></li></ul></div></div></header></div></div><div class="layout-content"><div class="container"><article><div class="layout-content__body"><div class="module-markdown">

<p><img src="/images/post/2015/08/install-restyaboard/index.jpg" alt="Resyaboard ScreenShot" /></p>

<p><code>Restyaboard</code>はプロジェクトをかんばん形式で管理できるオープンソースソフトウェア。
GitHubを見ると今年の中旬頃に<code>Initial commit</code>ということで、表に出たのは最近なんだろうか。</p>

<p><code>Pivotal Tracker</code>, <code>Trello</code>あたりは仕事でも使いたいなーとは思うのですが、<br />
クラウドっすか・・(^_^;) みたいな現場もあるので、
クローズドな環境に導入できるかんばんツールはかなりありがたい。</p>

<blockquote>
<p>Restyaboard | Trello like kanban board. Based on Restya platform.<br />
<a href="http://restya.com/board/">http://restya.com/board/</a></p>
</blockquote>

<p>AMIも提供しているとのことですが、
どの環境でも導入できるように構築手順を確立しておきたい。
んが、公式ドキュメントにインストール手順が記載されていなかったので、試行錯誤して何とか動くところまで持ち込んでみた。</p>

<h2 id="インストール手順:b5a2865b9ccb73515b3dffb76a8b1993">インストール手順</h2>

<p>必要なコンポーネントがそこそこ多く、インストール手順も面倒なため、<br />
<code>Vagrant</code>+<code>Itamae</code>で、構成管理ファイルも作っておいた。</p>

<blockquote>
<p>GitHub: Provision Restyaboard<br />
<a href="https://github.com/namikingsoft/provision-restyaboard">https://github.com/namikingsoft/provision-restyaboard</a></p>
</blockquote>

<h3 id="動作確認環境:b5a2865b9ccb73515b3dffb76a8b1993">動作確認環境</h3>

<ul>
<li>インフラ

<ul>
<li>AWS EC2 t2.micro</li>
</ul></li>
<li>OS/ディストリビューション

<ul>
<li>Amazon Linux</li>
</ul></li>
<li>インストールするソフトウェア

<ul>
<li>Restyaboard Ver.0.1.1</li>
</ul></li>
<li>デプロイパス

<ul>
<li>/var/www/board</li>
</ul></li>
<li>必要なミドルウェア

<ul>
<li>PostgreSQL 9.x</li>
<li>PHP 5.x</li>
<li>nginx</li>
<li>node.js (ビルドに必要)</li>
<li>Elasticsearch (任意？)</li>
</ul></li>
</ul>

<h3 id="node-js:b5a2865b9ccb73515b3dffb76a8b1993">node.js</h3>

<p>サーバー動作には使わないっぽいが、
<code>less</code>や<code>jst</code>のビルドに必要。</p>

<h4 id="インストール:b5a2865b9ccb73515b3dffb76a8b1993">インストール</h4>

<pre><code class="language-bash">$ sudo yum install -y nodejs npm
$ sudo npm install -g grunt-cli
</code></pre>

<h3 id="restyaboard:b5a2865b9ccb73515b3dffb76a8b1993">Restyaboard</h3>

<h4 id="ダウンロード:b5a2865b9ccb73515b3dffb76a8b1993">ダウンロード</h4>

<pre><code class="language-bash">$ cd /var/www
$ sudo git clone https://github.com/RestyaPlatform/board.git
</code></pre>

<h4 id="パーミッション設定:b5a2865b9ccb73515b3dffb76a8b1993">パーミッション設定</h4>

<p>アップロードした画像やファイルを保存するディレクトリに書き込み権限を付加。</p>

<pre><code class="language-bash">$ sudo chmod -R o+w /var/www/board/client/img
$ sudo chmod -R o+w /var/www/board/media
</code></pre>

<h4 id="ビルド:b5a2865b9ccb73515b3dffb76a8b1993">ビルド</h4>

<pre><code class="language-bash">$ cd /var/www/board
$ sudo npm install
$ sudo grunt build
</code></pre>

<h4 id="r設定:b5a2865b9ccb73515b3dffb76a8b1993">R設定</h4>

<p>PostgreSQL関連の認証情報が初期化されたので、環境に応じて設定を変更する。</p>

<pre><code class="language-bash">$ sudo vi /var/www/board/server/php/R/config.inc.php
</code></pre>

<p>ここでは以下の項目を書き換えた。</p>

<pre><code class="language-php">define('R_DB_USER', 'restya');
define('R_DB_PASSWORD', 'password');
</code></pre>

<h3 id="postgresql:b5a2865b9ccb73515b3dffb76a8b1993">PostgreSQL</h3>

<h4 id="インストール-サービス起動:b5a2865b9ccb73515b3dffb76a8b1993">インストール＆サービス起動</h4>

<pre><code class="language-bash">$ sudo yum install -y postgresql94-server

$ sudo chkconfig postgresql94 on
$ sudo service postgresql94 initdb
$ sudo service postgresql94 start
</code></pre>

<h4 id="db設定-ユーザー作成:b5a2865b9ccb73515b3dffb76a8b1993">DB設定＆ユーザー作成</h4>

<pre><code class="language-bash">$ sudo su - postgres
$ psql -U postgres -c \
  &quot;CREATE USER restya WITH ENCRYPTED PASSWORD 'password'&quot;
$ psql -U postgres -c \
  &quot;CREATE DATABASE restyaboard OWNER restya ENCODING 'UTF8'&quot;
$ exit
</code></pre>

<h4 id="認証設定:b5a2865b9ccb73515b3dffb76a8b1993">認証設定</h4>

<pre><code class="language-bash">$ sudo vi /var/lib/pgsql94/data/pg_hba.conf
</code></pre>

<p>既存のものはコメントアウトして、以下を追記する。</p>

<pre><code>local all postgres peer
local all all md5
host all all 127.0.0.1/32 md5
host all all ::1/128 md5
</code></pre>

<p><code>host</code>の設定をしないと、PHPで接続エラーが出るので注意。</p>

<h4 id="初期データ登録:b5a2865b9ccb73515b3dffb76a8b1993">初期データ登録</h4>

<pre><code class="language-bash">$ sudo su - postgres
$ psql -U postgres -d restyaboard -f \
  /var/www/board/sql/restyaboard_with_empty_data.sql
$ exit
</code></pre>

<h3 id="nginx:b5a2865b9ccb73515b3dffb76a8b1993">nginx</h3>

<p>WebAPI用のサーバー。</p>

<h4 id="インストール-1:b5a2865b9ccb73515b3dffb76a8b1993">インストール</h4>

<pre><code class="language-bash">$ sudo yum install -y nginx
</code></pre>

<h4 id="conf設定:b5a2865b9ccb73515b3dffb76a8b1993">conf設定</h4>

<p>設定例はRestyaboardのデプロイパスに格納されているので、
そこからコピーして、環境に応じて書き換える。</p>

<pre><code class="language-bash">$ sudo cp /var/www/board/restyaboard.conf /etc/nginx/conf.d/
$ sudo vi /etc/nginx/conf.d/restyaboard.conf
</code></pre>

<p>一括置換 <code>/usr/share/nginx/html</code> → <code>/var/www/board</code></p>

<h4 id="サービス起動:b5a2865b9ccb73515b3dffb76a8b1993">サービス起動</h4>

<pre><code class="language-bash">$ sudo chkconfig nginx on
$ sudo service nginx start
</code></pre>

<h3 id="php:b5a2865b9ccb73515b3dffb76a8b1993">PHP</h3>

<p>RestyaboardのPHPソースに<code>PHP version 5</code>とあるので、PHP5.6で動作させてみる。
以下のパッケージをいれれば、ひと通り動作するっぽい。</p>

<h4 id="インストール-2:b5a2865b9ccb73515b3dffb76a8b1993">インストール</h4>

<pre><code class="language-bash">$ sudo yum install -y \
    php56 php56-fpm php56-pgsql php56-mbstring php56-gd php56-pecl-imagick
</code></pre>

<p><code>Amazon Linux</code>であれば、標準リポジトリにPHP5.6が入っているみたい。
別ディストリビューションであれば、<code>remi</code>リポジトリなどを追加してから、
インストールする。</p>

<h4 id="php-fpmの設定:b5a2865b9ccb73515b3dffb76a8b1993">php-fpmの設定</h4>

<p>デフォルト設定がApache用になっているので、nginx用に書き換える。</p>

<pre><code class="language-bash">$ sudo vi /etc/php-fpm.d/www.conf
</code></pre>

<ul>
<li><code>user = apache</code> →  <code>user = nginx</code></li>
<li><code>group = apache</code> →  <code>group = nginx</code></li>
</ul>

<h4 id="サービス起動-1:b5a2865b9ccb73515b3dffb76a8b1993">サービス起動</h4>

<pre><code class="language-bash">$ sudo chkconfig php-fpm on
$ sudo service php-fpm start
</code></pre>

<h3 id="elasticsearch:b5a2865b9ccb73515b3dffb76a8b1993">ElasticSearch</h3>

<p>無くても、ある程度動くっぽいが一応。<br />
URLやIndexの設定は、インストール後のRestyaboard管理画面からできる。</p>

<h4 id="リポジトリ追加:b5a2865b9ccb73515b3dffb76a8b1993">リポジトリ追加</h4>

<pre><code class="language-bash">$ sudo vi /etc/yum.repos.d/elasticsearch.repo
</code></pre>

<pre><code class="language-ini">[elasticsearch-1.0]
name=Elasticsearch repository for 1.0.x packages
baseurl=http://packages.elasticsearch.org/elasticsearch/1.0/centos
gpgcheck=1
gpgkey=http://packages.elasticsearch.org/GPG-KEY-elasticsearch
enabled=0
</code></pre>

<h4 id="インストール-サービス起動-1:b5a2865b9ccb73515b3dffb76a8b1993">インストール＆サービス起動</h4>

<pre><code class="language-bash">$ sudo yum install -y --enablerepo='elasticsearch-1.0' elasticsearch

$ sudo chkconfig elasticsearch on
$ sudo service elasticsearch start
</code></pre>

<h4 id="crontab設定:b5a2865b9ccb73515b3dffb76a8b1993">Crontab設定</h4>

<p>インデックス更新のために、Crontabを設定する。<br />
5分毎に更新する場合は、以下のようにする。</p>

<pre><code class="language-bash">$ crontab -e
</code></pre>

<pre><code class="language-bash">*/5 * * * * php /var/www/board/server/php/R/shell/cron.php
</code></pre>

<h3 id="ファイアウォール設定など:b5a2865b9ccb73515b3dffb76a8b1993">ファイアウォール設定など</h3>

<p>AWSならセキュリティグループから、
その他Linuxなら<code>iptables</code>,<code>firewalld</code>などから、
<code>80</code>ポートを外向けに開放しておく。</p>

<h2 id="動作確認:b5a2865b9ccb73515b3dffb76a8b1993">動作確認</h2>

<h4 id="url:b5a2865b9ccb73515b3dffb76a8b1993">URL</h4>

<pre><code>http://(サーバーIP)/
</code></pre>

<p>ログインフォームが出てくれば、大方OK。</p>

<h4 id="ログイン情報:b5a2865b9ccb73515b3dffb76a8b1993">ログイン情報</h4>

<pre><code>管理者権限
Username: admin
Password: restya

ユーザー権限
Username: user
Password: restya
</code></pre>

<h4 id="つまづいた点:b5a2865b9ccb73515b3dffb76a8b1993">つまづいた点</h4>

<ul>
<li>ログインフォームが表示されない

<ul>
<li>PostgreSQLとのコネクションに失敗していた。</li>
<li><code>pg_hba.conf</code>でhostを設定することで解決</li>
</ul></li>
<li>ログイン後のフッターメニューが表示されない

<ul>
<li>PostgreSQLとのコネクションに失敗していた。</li>
<li><code>pg_hba.conf</code>でhostを設定することで解決</li>
</ul></li>
<li>アップロードした画像が表示されない。

<ul>
<li>パーミッションの設定が正しくない。</li>
<li>PHPパッケージが足りてなかった、<code>php-gd</code>,<code>php-pecl-imagick</code></li>
</ul></li>
<li>ボード編集中に、APIサーバーエラー(500)が頻発する

<ul>
<li>PHPパッケージが足りてなかった、<code>mstring</code></li>
</ul></li>
</ul>

<p>PostgreSQLやPHPパッケージの設定がうまく行えていないと、
上の様な不具合が出たりする。</p>

<h2 id="まとめ:b5a2865b9ccb73515b3dffb76a8b1993">まとめ</h2>

<p>構築手順や必要なパッケージが全て公開されていないため、
インストールはほぼデバッグ作業でしたが、なんとかうまく動かせるまでに至った。</p>

<p><code>Trello</code>などと比べるとUIはまだ洗練中という印象ですが、
基本的な機能はほぼ抑えているので、隙を見て使っていこうかな。</p>

<h4 id="追記-2015-08-28:b5a2865b9ccb73515b3dffb76a8b1993">追記： 2015/08/28</h4>

<p><code>LibreBoard</code>というのもあるらしい。こちらもTrelloクローンのOSS。<br />
Dockerfileも用意されてたので、インストールが楽すぎて涙。</p>

<blockquote>
<p>GitHub: LibreBoard<br />
<a href="https://github.com/libreboard/libreboard">https://github.com/libreboard/libreboard</a></p>
</blockquote>

<p>ちょっと触った感じだと、かなり絞ったシンプルなTrelloという感じ。
機能面では、<code>Restyaboard</code>の方が豊富な印象だが、
その分、UIもシンプルでとっつきやすい。</p>

<p>そのうち、細かい機能比較とかもまとめておきたい。</p>
</div></div><div class="layout-content__comment"><div class="module-comment"><div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'namikingsoft';
    var disqus_identifier = 'http:\/\/blog.namiking.net\/post\/2015\/08\/install-restyaboard\/';
    var disqus_title = 'かんばん系プロジェクト管理OSSのRestyaboardをインストールしてみる';
    var disqus_url = 'http:\/\/blog.namiking.net\/post\/2015\/08\/install-restyaboard\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div></div></article></div></div><div class="layout-pagenavi"><div class="container"><div class="layout-pagenavi__relate"><div class="module-relate"></div></div><div class="layout-pagenavi__paging"><div class="module-paging"><div class="module-paging__prev col-xs-6"></div><div class="module-paging__next col-xs-6"><a href="/about/" title="ABOUT"><span class="hidden-xs">ABOUT</span><i class="fa fa-arrow-circle-o-right"></i><p class="hidden-xs">2015-08-27 (Thu)</p></a></div></div></div></div></div><div class="layout-sharenavi"><div class="container"><h4>この記事について</h4><div class="layout-sharenavi__profile"><div class="module-profile"><div class="module-profile__avatar"><img src="https://s.gravatar.com/avatar/3706c1a344dc2282c6683b6c6d0926f2?s=80&r=g"><small>書いた人<br>Written by</small></div><div class="module-profile__text"><h3>namikingsoft</h3><p>何かを残して逝きたい<br>フロントエンドエンジニア</p><ul><li><a href="#"><i class="fa fa-2x fa-user"></i></a></li><li><a href="#"><i class="fa fa-2x fa-github"></i></a></li><li><a href="#"><i class="fa fa-2x fa-twitter"></i></a></li></ul></div></div></div><div class="layout-sharenavi__sharelink"><div class="module-sharelink"><ul class="module-sharelink__list"><li class="module-sharelink__list-twitter"><a class="twitter-share-button" data-url="http://blog.namiking.net/post/2015/08/install-restyaboard/" href="https://twitter.com/share" data-lang="ja" data-count="vertical" data-dnt="true">ツイート</a></li><li class="module-sharelink__list-facebook"><div class="fb-like" data-href="http://blog.namiking.net/post/2015/08/install-restyaboard/" data-layout="box_count" data-action="like" data-show-faces="true" data-share="false"></div></li><li class="module-sharelink__list-google"><div class="g-plusone" data-href="http://blog.namiking.net/post/2015/08/install-restyaboard/" data-size="tall"></div></li><li class="module-sharelink__list-hatena"><a class="hatena-bookmark-button" href="http://b.hatena.ne.jp/entry/http://blog.namiking.net/post/2015/08/install-restyaboard/" data-hatena-bookmark-layout="vertical-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border:none;"></a></li><li class="module-sharelink__list-pocket"><a class="pocket-btn" data-save-url="http://blog.namiking.net/post/2015/08/install-restyaboard/" data-pocket-label="pocket" data-pocket-count="vertical" data-lang="en"></a></li><li class="module-sharelink__list-line"><a href="http://line.me/R/msg/text/?http%3a%2f%2fblog.namiking.net%2fpost%2f2015%2f08%2finstall-restyaboard%2f"><img src="/images/button/linebutton_36x60.png" width="36" height="60" alt="LINEに送る"></a></li></ul><div id="fb-root"></div></div></div></div></div><div class="layout-footer"><div class="container"><div class="layout-footer__poweredby col-sm-4"><div class="module-poweredby"><div class="module-poweredby__title"><a href="http://blog.namiking.net/"><strong>Namiking.net</strong><p>Web系エンジニアの技術ブログ</p></a></div><div class="module-poweredby__menu"><ul><li><a href="http://blog.namiking.net/"><i class="fa fa-lg fa-home"></i><span>HOME</span></a></li><li><a href="http://blog.namiking.net/about/"><i class="fa fa-lg fa-user"></i><span>ABOUT</span></a></li><li><a href="https://github.com/namikingsoft/"><i class="fa fa-lg fa-github"></i><span>GITHUB</span></a></li><li><a href="https://twitter.com/namikingsoft/"><i class="fa fa-lg fa-twitter"></i><span>TWITTER</span></a></li></ul></div><div class="module-poweredby__hugo"><img src="https://s.gravatar.com/avatar/3706c1a344dc2282c6683b6c6d0926f2?s=45&r=g"><p>Written by <a href="/about">@namikingsoft</a></p><p>Powered by <a href="http://gohugo.io">HUGO</a></p></div></div></div><div class="layout-footer__recent col-sm-4"><div class="module-recent"><h3>Recent Post</h3><dl><dt>2015-08-27 (Thu)</dt><dd><a href="http://blog.namiking.net/post/2015/08/install-restyaboard/">かんばん系プロジェクト管理OSSのRestyaboardをインストールしてみる</a></dd><dt>2015-08-27 (Thu)</dt><dd><a href="http://blog.namiking.net/about/">ABOUT</a></dd></dl></div></div><div class="layout-footer__tagcloud col-sm-4"><div class="module-tagcloud"><h3>Tags</h3><ul><li><a href="/tags/itamae">itamae(1)</a></li><li><a href="/tags/oss">oss(1)</a></li><li><a href="/tags/restyaboard">restyaboard(1)</a></li><li><a href="/tags/vagrant">vagrant(1)</a></li><li><a href="/tags/%E3%82%B9%E3%82%AD%E3%83%AB%E3%82%B7%E3%83%BC%E3%83%88">スキルシート(1)</a></li></ul></div></div></div></div></body></html>